# 하이브리드 검색 전략 문서

## 개요

하이브리드 검색은 키워드 검색과 벡터 검색을 결합하여 더 정확하고 관련성 높은 검색 결과를 제공하는 시스템입니다.

## 전략 설계

### 1. 가중치 기반 결합 전략

#### 가중치 설정
- **키워드 검색 가중치**: 40% (0.4)
- **벡터 검색 가중치**: 60% (0.6)

#### 선택 이유
- **벡터 검색 우선**: 의미론적 유사성을 더 중요하게 여김
- **키워드 검색 보완**: 정확한 키워드 매칭도 고려
- **수험생 특화**: 학습 내용의 의미적 연결성을 중시

### 2. 점수 정규화

#### 정규화 방법
```typescript
normalizedScore = (score - minScore) / (maxScore - minScore)
```

#### 정규화 목적
- 키워드 검색과 벡터 검색의 점수 스케일 통일
- 0-1 범위로 정규화하여 가중치 적용 가능
- 검색 결과의 일관성 보장

### 3. 결과 결합 알고리즘

#### 단계별 프로세스
1. **병렬 검색 실행**: 키워드 검색과 벡터 검색 동시 실행
2. **점수 정규화**: 각 검색 결과의 점수를 0-1 범위로 정규화
3. **결과 결합**: 동일한 문서에 대해 가중 평균 계산
4. **중복 제거**: 동일한 문서는 하나로 통합
5. **최종 정렬**: 결합된 점수로 내림차순 정렬

#### 결합 공식
```typescript
combinedScore = (keywordScore * 0.4) + (vectorScore * 0.6)
```

### 4. 성능 최적화

#### 병렬 처리
- 키워드 검색과 벡터 검색을 동시에 실행
- 전체 검색 시간 단축

#### 캐싱 전략
- 자주 사용되는 쿼리 결과 캐싱
- 임베딩 생성 결과 캐싱

#### 인덱스 최적화
- 키워드 검색: `notes_text_index`
- 벡터 검색: `notes_vector_index`

## 구현 세부사항

### 1. 키워드 검색 (MongoDB Atlas Search)

#### 인덱스 구성
```json
{
  "name": "notes_text_index",
  "type": "search",
  "fields": [
    {
      "path": "content",
      "type": "string"
    },
    {
      "path": "tags",
      "type": "string"
    }
  ]
}
```

#### 검색 옵션
- **Fuzzy Matching**: 오타 허용 (maxEdits: 1)
- **Prefix Matching**: 접두사 검색 지원
- **Multi-field Search**: content와 tags 필드 모두 검색

### 2. 벡터 검색 (MongoDB Atlas Vector Search)

#### 인덱스 구성
```json
{
  "name": "notes_vector_index",
  "type": "search",
  "fields": [
    {
      "path": "embedding",
      "numDimensions": 1536,
      "similarity": "cosine"
    }
  ]
}
```

#### 검색 옵션
- **Cosine Similarity**: 벡터 유사도 측정
- **numCandidates**: 100개 후보 검색
- **limit**: 최대 50개 결과 반환

### 3. 에러 처리 및 폴백

#### 폴백 전략
1. **벡터 검색 실패**: 키워드 검색만 사용
2. **키워드 검색 실패**: 벡터 검색만 사용
3. **모든 검색 실패**: 빈 결과 반환

#### 로깅 및 모니터링
- 각 검색 단계별 성능 측정
- 에러 발생 시 상세 로그 기록
- 검색 통계 수집

## 성능 지표

### 목표 성능
- **응답 시간**: 200ms 이내
- **정확도**: 85% 이상
- **재현율**: 80% 이상

### 모니터링 지표
- 검색 쿼리별 응답 시간
- 키워드/벡터 검색 결과 수
- 결합된 결과의 품질 점수
- 사용자 만족도

## 향후 개선 계획

### 1. 동적 가중치 조정
- 쿼리 유형에 따른 가중치 자동 조정
- 사용자 피드백 기반 가중치 학습

### 2. 고급 결합 알고리즘
- Reciprocal Rank Fusion (RRF) 적용 검토
- 사용자별 개인화된 가중치

### 3. 실시간 최적화
- 검색 패턴 분석을 통한 실시간 조정
- A/B 테스트를 통한 지속적 개선 