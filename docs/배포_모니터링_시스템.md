# μ‹κ°„ κΈ°λ΅ μ‹μ¤ν… λ‹¨κ³„μ  λ°°ν¬ λ° λ¨λ‹ν„°λ§

## π― λ°°ν¬ μ „λµ κ°μ”

Habitus33 μ‹κ°„ κΈ°λ΅ μ‹μ¤ν…μ μ•μ „ν• ν”„λ΅λ•μ… λ°°ν¬λ¥Ό μ„ν• λ‹¨κ³„μ  μ ‘κ·Ό λ°©μ‹κ³Ό μ‹¤μ‹κ°„ λ¨λ‹ν„°λ§ μ²΄κ³„μ…λ‹λ‹¤.

## π€ Phase 1: μ¤ν…μ΄μ§• ν™κ²½ λ°°ν¬ (ν„μ¬ μ™„λ£)

### μ™„λ£λ κµ¬μ„±μ”μ†
- β… ν΄λΌμ΄μ–ΈνΈ μ‹κ°„ μμ§‘ (Shadow Mode)
- β… λ°±μ—”λ“ μ‹κ°„ μ²λ¦¬ λ΅μ§
- β… MongoDB Atlas μ¤ν‚¤λ§ ν™•μ¥
- β… ν”„λ΅ νΈμ—”λ“ ν‘μ‹ λ΅μ§ κ°μ„ 
- β… Render μ„λ²„ μ‹κ°„λ€ μ„¤μ •
- β… ν†µν•© ν…μ¤νΈ μ‹μ¤ν…

### μ¤ν…μ΄μ§• κ²€μ¦ μ²΄ν¬λ¦¬μ¤νΈ
```bash
# 1. μ„λ²„ ν™κ²½ κ²€μ¦
npm run check-timezone
npm run validate-atlas

# 2. μ‹μ¤ν… ν†µν•© ν…μ¤νΈ
npm run integration-test
npm run test-time-system

# 3. API ν—¬μ¤μ²΄ν¬
curl https://habitus33-api.onrender.com/api/health
```

## π Phase 2: Blue-Green λ°°ν¬ μ¤€λΉ„

### λ°°ν¬ μ•μ „μ„± κ²€μ¦
1. **ν„μ¬ ν”„λ΅λ•μ… λ°±μ—…**
   - MongoDB Atlas μλ™ λ°±μ—… ν™•μΈ
   - μ¤‘μ” μ»¬λ ‰μ… μ¶”κ°€ μ¤λƒ…μƒ·
   - μ½”λ“ νƒκ·Έ μƒμ„± (`git tag v2.0.0-time-system`)

2. **λ΅¤λ°± κ³„ν μλ¦½**
   - ν™κ²½λ³€μ μ›λ³µ: `TZ` μ κ±°
   - ν΄λΌμ΄μ–ΈνΈ μ½”λ“ rollback
   - λ°μ΄ν„°λ² μ΄μ¤λ” μ΄λ―Έ νΈν™μ„± λ³΄μ¥

3. **μΉ΄λ‚λ¦¬ λ°°ν¬ μ„¤μ •**
   - Renderμ μλ™ λ°°ν¬ ν™μ©
   - νΈλν”½ μ μ§„μ  μ΄λ™ (10% β†’ 50% β†’ 100%)

## π“ Phase 3: μ‹¤μ‹κ°„ λ¨λ‹ν„°λ§ μ‹μ¤ν…

### ν•µμ‹¬ λ¨λ‹ν„°λ§ μ§€ν‘

#### 1. μ‹κ°„ μ •ν™•μ„± μ§€ν‘
- **ν΄λΌμ΄μ–ΈνΈ μ‹κ°„ μ‚¬μ©λ¥ **: μ „μ²΄ λ©”λ¨ μ¤‘ ν΄λΌμ΄μ–ΈνΈ μ‹κ°„ λΉ„μ¨
- **μ‹κ°„ μ°¨μ΄ λ¶„ν¬**: ν΄λΌμ΄μ–ΈνΈ-μ„λ²„ μ‹κ°„ μ°¨μ΄ νμ¤ν† κ·Έλ¨
- **μμ™Έ μΌ€μ΄μ¤**: λΉ„μ •μƒ μ‹κ°„μΌλ΅ μΈν• fallback λΉλ„

#### 2. μ„±λ¥ μ§€ν‘
- **λ©”λ¨ μƒμ„± μ§€μ—°μ‹κ°„**: P50, P90, P99 κΈ°μ¤€
- **λ©”λ¨ μ΅°ν μ†λ„**: μ‹κ°„ ν•„λ“ μ¶”κ°€λ΅ μΈν• μν–¥
- **λ°μ΄ν„°λ² μ΄μ¤ μΏΌλ¦¬**: μΈλ±μ¤ ν¨μ¨μ„± λ¨λ‹ν„°λ§

#### 3. μ¤λ¥ μ§€ν‘
- **μ‹κ°„ μ²λ¦¬ μ¤λ¥μ¨**: ν΄λΌμ΄μ–ΈνΈ μ‹κ°„ κ²€μ¦ μ‹¤ν¨
- **API μ¤λ¥μ¨**: μ‹κ°„ κ΄€λ ¨ μ—”λ“ν¬μΈνΈ
- **μ‚¬μ©μ λ¶λ§ μ§€ν‘**: κ³ κ°μ§€μ› λ¬Έμ μ¦κ°

### λ¨λ‹ν„°λ§ λ„κµ¬ κµ¬μ„±

#### A. μ„λ²„ λ΅κ·Έ λ¶„μ„
```bash
# μ‹κ°„ μ²λ¦¬ κ΄€λ ¨ λ΅κ·Έ ν•„ν„°λ§
grep "TimeProcessor" /var/log/app.log | tail -100

# μ¤λ¥ ν¨ν„΄ κ°μ§€
grep -E "(TimeProcessor.*ERROR|μ‹κ°„.*μ¤λ¥)" /var/log/app.log
```

#### B. μ‹¤μ‹κ°„ λ€μ‹λ³΄λ“
- **Render λ‚΄μ¥ λ¨λ‹ν„°λ§**: CPU, λ©”λ¨λ¦¬, μ‘λ‹µμ‹κ°„
- **MongoDB Atlas λ¨λ‹ν„°λ§**: μΏΌλ¦¬ μ„±λ¥, μΈλ±μ¤ μ‚¬μ©λ¥ 
- **μ‚¬μ©μ μ§€μ • λ©”νΈλ¦­**: μ‹κ°„ μ •ν™•μ„± μ§€ν‘

## π¨ Phase 4: μ•λ λ° μλ™ λ€μ‘

### Critical μ•λ (μ¦‰μ‹ λ€μ‘)
1. **μ‹κ°„ μ²λ¦¬ μ‹¤ν¨μ¨ > 5%**
   - μ¬λ™ μ•λ¦Ό + SMS
   - μλ™ rollback κ³ λ ¤

2. **API μ‘λ‹µμ‹κ°„ > 2μ΄**
   - μΈν”„λΌ μ¤μΌ€μΌλ§ νΈλ¦¬κ±°
   - λ°μ΄ν„°λ² μ΄μ¤ μ„±λ¥ μ κ²€

3. **MongoDB μ—°κ²° μ‹¤ν¨**
   - μ„λΉ„μ¤ ν—¬μ¤μ²΄ν¬ μ‹¤ν¨
   - μλ™ μ¬μ‹μ‘ λ©”μ»¤λ‹μ¦

### Warning μ•λ (λ¨λ‹ν„°λ§)
1. **ν΄λΌμ΄μ–ΈνΈ μ‹κ°„ μ‚¬μ©λ¥  < 80%**
   - λΈλΌμ°μ € νΈν™μ„± λ¬Έμ  κ°€λ¥μ„±
   - ν΄λΌμ΄μ–ΈνΈ μ½”λ“ κ²€ν†  ν•„μ”

2. **μ‹κ°„ μ°¨μ΄ > 1μ‹κ°„ λΉλ„ μ¦κ°€**
   - νΉμ • μ§€μ—­/λΈλΌμ°μ € λ¬Έμ  λ¶„μ„
   - μ‚¬μ©μ κµμ΅ ν•„μ”μ„± κ²€ν† 

## π“ Phase 5: μ„±κ³Ό μΈ΅μ • λ° μµμ ν™”

### λ°°ν¬ ν›„ 7μΌ μ£Όμ” KPI

#### κΈ°λ¥ μ„±κ³Ό
- **μ‹κ°„ μ •ν™•μ„±**: μ‚¬μ©μ ν„μ§€ μ‹κ°„ ν‘μ‹ μ •ν™•λ„ 95% μ΄μƒ
- **μ‚¬μ©μ λ§μ΅±λ„**: μ‹κ°„ κ΄€λ ¨ λ¬Έμ 50% κ°μ†
- **λ°μ΄ν„° ν’μ§**: ν΄λΌμ΄μ–ΈνΈ μ‹κ°„ κΈ°λ΅ λΉ„μ¨ 85% μ΄μƒ

#### κΈ°μ  μ„±κ³Ό
- **μ„±λ¥ μν–¥**: API μ‘λ‹µμ‹κ°„ 5% μ΄λ‚΄ μ¦κ°€
- **μ•μ •μ„±**: 99.9% uptime μ μ§€
- **ν™•μ¥μ„±**: λ™μ‹ μ‚¬μ©μ μ¦κ°€ λ€μ‘

### μ§€μ†μ  κ°μ„  κ³„ν

#### λ‹¨κΈ° (1-2μ£Ό)
- μ‚¬μ©μ ν”Όλ“λ°± μμ§‘ λ° λ¶„μ„
- μμ™Έ μΌ€μ΄μ¤ ν¨ν„΄ λ¶„μ„
- μ„±λ¥ λ³‘λ© μ§€μ  μ‹λ³„

#### μ¤‘κΈ° (1κ°μ›”)
- λΈλΌμ°μ €λ³„ νΈν™μ„± κ°μ„ 
- μ‹κ°„λ€λ³„ μ‚¬μ© ν¨ν„΄ λ¶„μ„
- μ¶”κ°€ μµμ ν™” κΈ°ν λ°κµ΄

#### μ¥κΈ° (3κ°μ›”)
- κΈ€λ΅λ² μ‚¬μ©μ ν™•μ¥ λ€λΉ„
- μ‹κ°„ μ •ν™•μ„± μ•κ³ λ¦¬μ¦ κ³ λ„ν™”
- ML κΈ°λ° μ΄μƒ μ‹κ°„ κ°μ§€

## π› οΈ λ°°ν¬ μ‹¤ν–‰ λ…λ Ήμ–΄

### 1. μµμΆ… κ²€μ¦
```bash
# μ „μ²΄ μ‹μ¤ν… κ²€μ¦
npm run check-timezone && npm run validate-atlas && npm run integration-test

# νƒ€μ… μ²΄ν¬ λ° λΉλ“
npm run build
```

### 2. Git νƒκ·Έ λ° ν‘Έμ‹
```bash
# λ¦΄λ¦¬μ¦ νƒκ·Έ μƒμ„±
git tag -a v2.0.0-time-system -m "μ‹κ°„ κΈ°λ΅ μ‹μ¤ν… κ°μ„ : μ‚¬μ©μ ν„μ§€ μ‹κ°„ μ§€μ›"

# νƒκ·Έ ν‘Έμ‹
git push origin v2.0.0-time-system

# λ©”μΈ λΈλμΉ ν‘Έμ‹ (Render μλ™ λ°°ν¬)
git push origin main
```

### 3. λ°°ν¬ ν›„ μ¦‰μ‹ κ²€μ¦
```bash
# API ν—¬μ¤μ²΄ν¬ (λ°°ν¬ ν›„ 2λ¶„ λ‚΄)
curl -s https://habitus33-api.onrender.com/api/health | jq '.timezone.isKoreanTime'

# μ‹¤μ‹κ°„ λ΅κ·Έ ν™•μΈ
# Render λ€μ‹λ³΄λ“μ—μ„ λ΅κ·Έ μ¤νΈλ¦Ό λ¨λ‹ν„°λ§

# μ²« λ©”λ¨ μƒμ„± ν…μ¤νΈ
# ν”„λ΅ νΈμ—”λ“μ—μ„ μλ™ ν…μ¤νΈ μν–‰
```

## π“‹ λ°°ν¬ μ²΄ν¬λ¦¬μ¤νΈ

### Pre-deployment (λ°°ν¬ μ „)
- [ ] λ¨λ“  ν†µν•© ν…μ¤νΈ ν†µκ³Ό
- [ ] μ½”λ“ λ¦¬λ·° μ™„λ£
- [ ] λ°±μ—… ν™•μΈ
- [ ] λ΅¤λ°± κ³„ν μλ¦½
- [ ] λ¨λ‹ν„°λ§ λ€μ‹λ³΄λ“ μ¤€λΉ„

### During deployment (λ°°ν¬ μ¤‘)
- [ ] Render μλ™ λ°°ν¬ μ„±κ³µ
- [ ] ν—¬μ¤μ²΄ν¬ API μ •μƒ μ‘λ‹µ
- [ ] μ‹κ°„λ€ μ„¤μ • ν™•μΈ
- [ ] μ²« λ²μ§Έ λ©”λ¨ μƒμ„± ν…μ¤νΈ

### Post-deployment (λ°°ν¬ ν›„)
- [ ] 24μ‹κ°„ λ¨λ‹ν„°λ§ μν–‰
- [ ] μ‚¬μ©μ ν”Όλ“λ°± μμ§‘
- [ ] μ„±λ¥ λ©”νΈλ¦­ λ¶„μ„
- [ ] μ¤λ¥ λ΅κ·Έ κ²€ν† 
- [ ] λ‹¤μ μµμ ν™” κ³„ν μλ¦½

## π― μ„±κ³µ κΈ°μ¤€

### λ‹¨κΈ° μ„±κ³µ (24μ‹κ°„)
- API μ‘λ‹µμ‹κ°„ κΈ°μ΅΄ λ€λΉ„ 5% μ΄λ‚΄
- μ¤λ¥μ¨ 1% λ―Έλ§ μ μ§€
- μ‚¬μ©μ λ¶λ§ 0κ±΄

### μ¤‘κΈ° μ„±κ³µ (1μ£ΌμΌ)
- ν΄λΌμ΄μ–ΈνΈ μ‹κ°„ μ‚¬μ©λ¥  80% μ΄μƒ
- μ„±λ¥ μ €ν• μ—†μ
- μ‹κ°„ μ •ν™•μ„± 95% μ΄μƒ

### μ¥κΈ° μ„±κ³µ (1κ°μ›”)
- μ‹κ°„ κ΄€λ ¨ μ‚¬μ©μ λ¬Έμ 50% κ°μ†
- κΈ€λ΅λ² μ‚¬μ©μ λ§μ΅±λ„ ν–¥μƒ
- μ‹μ¤ν… μ•μ •μ„± 99.9% μ μ§€

---

**β οΈ μ„ν— μ‹ νΈ (μ¦‰μ‹ λ΅¤λ°± κ³ λ ¤)**
- API μ¤λ¥μ¨ > 3%
- μ‘λ‹µμ‹κ°„ > 3μ΄ μ§€μ†
- μ‚¬μ©μ λ¶λ§ κΈ‰μ¦
- λ°μ΄ν„° μ†μ‹¤ μμ‹¬

**β… μ„±κ³µ μ‹ νΈ (κ³„μ† μ§„ν–‰)**
- λ¨λ“  ν—¬μ¤μ²΄ν¬ ν†µκ³Ό
- μ„±λ¥ μ§€ν‘ μ•μ •
- μ‚¬μ©μ κΈμ • ν”Όλ“λ°±
- μ‹κ°„ μ •ν™•μ„± λ©ν‘ λ‹¬μ„± 