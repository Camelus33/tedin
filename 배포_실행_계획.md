# 시간 기록 시스템 모노레포 자동 배포 실행 계획

## 🏗️ 현재 배포 아키텍처

```
habitus33/ (모노레포)
├── frontend/     → Vercel 자동 배포
├── backend/      → Render 자동 배포
└── Git Push      → 양쪽 동시 배포 트리거
```

## 🎯 배포 실행 단계

### Phase 1: 최종 배포 전 검증 ✅
**완료된 구성요소:**
- ✅ 클라이언트 시간 수집 로직 (`frontend/lib/timeUtils.ts`)
- ✅ 백엔드 시간 처리 (`backend/src/utils/timeProcessor.ts`)
- ✅ Note 모델 확장 (`backend/src/models/Note.ts`)
- ✅ TSNoteCard 표시 로직 개선 (`frontend/components/ts/TSNoteCard.tsx`)
- ✅ Render 환경설정 (`backend/render.yaml`)
- ✅ 통합 테스트 시스템 (`backend/src/scripts/integrationTest.ts`)
- ✅ 실시간 모니터링 (`backend/src/scripts/deploymentMonitor.ts`)

### Phase 2: 자동 배포 실행 (현재 단계)
```bash
# 1. 배포 전 최종 검증
cd backend && npm run deploy-check

# 2. Git 태그 생성 (릴리즈 마킹)
git tag -a v2.0.0-time-system -m "시간 기록 시스템 개선: 사용자 현지 시간 지원"

# 3. 모든 변경사항 커밋 및 푸시 (자동 배포 트리거)
git add .
git commit -m "feat: 시간 기록 시스템 개선 - 사용자 현지 시간 지원

- 클라이언트 시간 수집 및 처리 로직 구현
- MongoDB clientCreatedAt 필드 추가
- Render 서버 시간대 설정 (Asia/Seoul)
- 통합 테스트 및 모니터링 시스템 구축
- Zero-downtime 배포로 기존 기능 100% 보장"

git push origin main
git push origin v2.0.0-time-system
```

### Phase 3: 배포 상태 모니터링

#### 3-1. Vercel 프론트엔드 배포 확인
- **배포 URL**: `https://habitus33.vercel.app`
- **예상 배포 시간**: 2-3분
- **확인 사항**:
  - 빌드 성공 여부
  - 새로운 시간 표시 로직 정상 작동
  - 타입스크립트 컴파일 오류 없음

#### 3-2. Render 백엔드 배포 확인
- **배포 URL**: `https://habitus33-api.onrender.com`
- **예상 배포 시간**: 5-10분 (Cold Start 포함)
- **확인 사항**:
  - 서버 시작 성공
  - 시간대 설정 적용 (`TZ=Asia/Seoul`)
  - MongoDB Atlas 연결 정상
  - 새로운 시간 처리 로직 활성화

### Phase 4: 배포 후 즉시 검증

#### 4-1. API 헬스체크 (배포 후 5분 내)
```bash
# 서버 상태 확인
curl -s https://habitus33-api.onrender.com/api/health | jq '.'

# 시간대 설정 확인
curl -s https://habitus33-api.onrender.com/api/health | jq '.timezone'

# 응답 예시:
# {
#   "status": "healthy",
#   "timestamp": "2024-01-15T12:30:45.123Z",
#   "timezone": {
#     "current": "Asia/Seoul",
#     "offset": -540,
#     "isKoreanTime": true
#   }
# }
```

#### 4-2. 실시간 모니터링 시작
```bash
# 백엔드 서버에서 모니터링 시작
cd backend && npm run monitor-live

# 또는 일회성 체크
npm run post-deploy
```

#### 4-3. 기능 테스트 (수동)
1. **프론트엔드에서 새 메모 생성**
   - TS 세션 진행
   - 메모 작성
   - 시간 표시 확인 (사용자 현지 시간)

2. **데이터베이스 확인**
   ```javascript
   // MongoDB에서 새로 생성된 Note 확인
   db.notes.findOne({}, {sort: {_id: -1}})
   // clientCreatedAt 필드 존재 확인
   ```

## 📊 배포 성공 지표

### 즉시 확인 (배포 후 10분)
- [ ] Vercel 빌드 성공 ✅/❌
- [ ] Render 배포 성공 ✅/❌
- [ ] API 헬스체크 통과 ✅/❌
- [ ] 시간대 설정 적용 ✅/❌
- [ ] 첫 메모 생성 테스트 성공 ✅/❌

### 단기 모니터링 (24시간)
- [ ] 클라이언트 시간 사용률 > 80%
- [ ] API 응답시간 기존 대비 5% 이내
- [ ] 오류율 < 1%
- [ ] 사용자 불만 0건

### 중기 검증 (1주일)
- [ ] 시간 정확성 95% 이상
- [ ] 성능 저하 없음
- [ ] 모든 기존 기능 정상 작동

## 🚨 롤백 계획

### 자동 롤백 조건
- API 오류율 > 5%
- 응답시간 > 3초 지속 (10분 이상)
- 사용자 불만 급증

### 롤백 실행
```bash
# 1. 이전 버전으로 Git 롤백
git revert HEAD --no-edit
git push origin main

# 2. 환경변수 원복 (Render)
# render.yaml에서 TZ 환경변수 제거

# 3. 데이터는 호환성 보장으로 롤백 불필요
# clientCreatedAt 필드는 Optional이므로 기존 로직 영향 없음
```

## 📈 배포 후 액션 아이템

### Day 1 (배포일)
- [ ] 연속 모니터링 (8시간)
- [ ] 주요 메트릭 수집
- [ ] 사용자 피드백 모니터링

### Day 2-7 (1주차)
- [ ] 일일 메트릭 리뷰
- [ ] 성능 트렌드 분석
- [ ] 예외 케이스 패턴 식별

### Week 2-4 (1개월)
- [ ] 월간 성과 리포트 작성
- [ ] 추가 최적화 기회 발굴
- [ ] 글로벌 확장 준비

## 🎯 성공 기준 요약

### 기술적 성공
- **정확성**: 사용자 현지 시간 95% 이상 정확
- **성능**: 기존 대비 5% 이내 응답시간
- **안정성**: 99.9% 업타임 유지
- **호환성**: 모든 기존 기능 100% 정상

### 사용자 경험 성공
- **시간 관련 문의**: 50% 감소
- **만족도**: 시간 표시 정확성 개선 체감
- **글로벌 사용**: 다양한 시간대 지원 확인

---

## 🛠️ 지금 실행할 명령어

```bash
# 최종 검증
cd backend && npm run deploy-check

# 성공 시 배포 실행
git add . && git commit -m "feat: 시간 기록 시스템 개선 완료" && git push origin main
```

**배포 예상 완료 시간**: 약 10-15분
**모니터링 시작**: 배포 완료 즉시
**첫 성과 확인**: 24시간 후 